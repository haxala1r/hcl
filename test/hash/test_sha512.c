#include "../../include/hash.h"
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

char *sha512_msgs[] = {
	"",
	"ABCD",
	"The quick brown fox jumps over the lazy dog"
};

uint8_t sha512_expected[][64] = {
	{0xcf,0x83,0xe1,0x35,0x7e,0xef,0xb8,0xbd,0xf1,0x54,0x28,0x50,0xd6,0x6d,0x80,
	0x7,0xd6,0x20,0xe4,0x5,0xb,0x57,0x15,0xdc,0x83,0xf4,0xa9,0x21,0xd3,0x6c,0xe9,
	0xce,0x47,0xd0,0xd1,0x3c,0x5d,0x85,0xf2,0xb0,0xff,0x83,0x18,0xd2,0x87,0x7e,
	0xec,0x2f,0x63,0xb9,0x31,0xbd,0x47,0x41,0x7a,0x81,0xa5,0x38,0x32,0x7a,0xf9,
	0x27,0xda,0x3e
	},
	{0x49,0xec,0x55,0xbd,0x83,0xfc,0xd6,0x78,0x38,0xe3,0xd3,0x85,0xce,0x83,0x16,
	0x69,0xe3,0xf8,0x15,0xa7,0xf4,0x4b,0x7a,0xa5,0xf8,0xd5,0x2b,0x5d,0x42,0x35,
	0x4c,0x46,0xd8,0x9c,0x8b,0x9d,0x6,0xe4,0x7a,0x79,0x7a,0xe4,0xfb,0xd2,0x22,
	0x91,0xbe,0x15,0xbc,0xc3,0x5b,0x7,0x73,0x5c,0x4a,0x6f,0x92,0x35,0x7f,0x93,
	0xd5,0xa3,0x3d,0x9b
	},
	{0x7,0xe5,0x47,0xd9,0x58,0x6f,0x6a,0x73,0xf7,0x3f,0xba,0xc0,0x43,0x5e,0xd7,
	0x69,0x51,0x21,0x8f,0xb7,0xd0,0xc8,0xd7,0x88,0xa3,0x9,0xd7,0x85,0x43,0x6b,
	0xbb,0x64,0x2e,0x93,0xa2,0x52,0xa9,0x54,0xf2,0x39,0x12,0x54,0x7d,0x1e,0x8a,
	0x3b,0x5e,0xd6,0xe1,0xbf,0xd7,0x9,0x78,0x21,0x23,0x3f,0xa0,0x53,0x8f,0x3d,
	0xb8,0x54,0xfe,0xe6
	}
};

int test_sha512(void) {
	int test_count = sizeof(sha512_msgs) / sizeof(*sha512_msgs);

	for (int j = 0; j < test_count; j++) {
		char *out = HCL_sha512(sha512_msgs[j], strlen(sha512_msgs[j]));

		if (memcmp(out, sha512_expected[j], 64)) {
			printf("[HCL_sha512] Test %d failed\n", j);
			return -1;
		}
		free(out);
	}
	printf("[HCL_sha512] Test passed\n");

	return 0;
}
